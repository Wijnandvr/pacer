<!DOCTYPE html>
<html lang="en">
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <link href='//fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic' rel='stylesheet' type='text/css'> -->
     <link rel="stylesheet" href="/pacer-doc/css/syntax.css"  type='text/css'>
     <link rel="stylesheet" href="/pacer-doc/css/font-awesome.min.css">
     <link rel="stylesheet" href="/pacer-doc/css/bootstrap.min.css">
     <link rel="stylesheet" href="/pacer-doc/css/modern-business.css">
    <link rel="stylesheet" href="/pacer-doc/css/lavish-bootstrap.css"  type='text/css'>
    <link rel="canonical" href="/pacer-doc/pacer-extensions/">
    <link rel="stylesheet" href="/pacer-doc/css/customstyles.css"  type='text/css'>
     <link rel="stylesheet" href="/pacer-doc/css/projectstyles.css"  type='text/css'>
    <link rel="canonical" href="/pacer-doc/pacer-extensions/">
  <link rel="alternate" type="application/rss+xml" title="Pacer Docs" href="/pacer-doc/feed.xml" />
    <script src="/pacer-doc/js/jquery.min.js"></script>
    <script src="/pacer-doc/js/jquery.cookie.min.js"></script>
    <script src="/pacer-doc/js/jquery.navgoco.min.js"></script>
    <script src="/pacer-doc/js/bootstrap.min.js"></script>
    <script src="/pacer-doc/js/toc.js"></script>
    <script src="/pacer-doc/js/customscripts.js"></script>
    <script src="/pacer-doc/js/projectscripts.js"></script>
       <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <title>Pacer Extensions | Pacer Docs</title>
     <meta name="description" content="A theme based on Jekyll designed for technical writers creating help systems. Feel free to clone, fork, and otherwise use. It's all open source and free to implement.  Please consider contributing back any innovations you make so that others can benefit.
">
 

 

  </head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                  <a class="navbar-brand homeLink fa fa-home" href="/pacer-doc/"><span class="projectHome"> &nbsp;Pacer Docs</span></a>

                 
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

<!-- entries without drop-downs appear here -->
  
  

  
  <li><a href="https://github.com/pangloss/pacer/" target="_blank">Github Repo</a></li>
  
     
    


<!-- entries with drop-downs appear here -->


<li>
<!-- start search -->
   <div id="search-demo-container">
      <input type="text" id="search-input" placeholder="search...">
      <ul id="results-container"></ul>
    </div>

    
    <script src="/pacer-doc/js/jekyll-search.js" type="text/javascript"></script>
    
    
    <script type="text/javascript">
      SimpleJekyllSearch.init({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        dataSource: '/pacer-doc/search.json',        
        searchResultTemplate: '<li><a href="{url}" title="Pacer Extensions">{title}</a></li>',
        noResultsText: 'No results found.',
        limit: 10,
        fuzzy: true,
      })
    </script>
    <!-- end search -->
 </li>



        </div>

        <!-- /.container -->
    </nav>


    <!-- Page Content -->
    <div class="container">
    <div class="col-lg-12">&nbsp;</div>





 <!-- Content Row -->
        <div class="row">
            <!-- Sidebar Column -->
            <div class="col-md-3">

<script>
$(document).ready(function() {
    // Initialize navgoco with default options
    $("#mysidebar").navgoco({
        caretHtml: '',
        accordion: true,
        openClass: 'active', // open
        save: true,
        cookie: {
            name: 'navgoco',
            expires: false,
            path: '/'
        },
        slide: {
            duration: 400,
            easing: 'swing'
        }
    });

    $("#collapseAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', false);
    });

    $("#expandAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', true);
    });
});

</script>
  
<!-- note that the data file for your project needs to be specified in the code below. Instead of site.data.jekyll, use the data file corresponding to your project (create one if it doesn't already exist). -->

<ul id="mysidebar" class="nav">


  
  
    <li><a href="#">Introduction</a>
    <ul>
    
    
      
      <li><a href="/pacer-doc/intro/">What is Pacer?</a></li>
    
     
    
    
      
      <li><a href="/pacer-doc/install/">Installation</a></li>
    
     
    
    
      
      <li><a href="/pacer-doc/quick_start/">Quick Start</a></li>
    
     
    
    
      
      <li><a href="/pacer-doc/suppoted_graph_databases/">Supported Databases</a></li>
    
     
    
    
      
      <li><a href="/pacer-doc/contributing/">Contributing to Pacer</a></li>
    
     
    
    </ul>
    </li>
  
    <li><a href="#">Fundamentals</a>
    <ul>
    
    
      
      <li class="active"><a href="/pacer-doc/pacer-extensions/" class="active">Extensions</a></li>
    
     
    
    
      
      <li><a href="/pacer-doc/routes/">Routes</a></li>
    
     
    
    </ul>
    </li>
  



</div>




            <!-- Content Column -->
            <div class="col-md-9">

                <div class="post-header">
  <h1 class="post-title-main">Pacer Extensions</h1>
</div>
<div class="post-content">

<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>


<div id="toc"></div>


<p>Pacer extensions are a powerful tool that allows developers to:
 * Process the graph using familiar object-oriented techniques.
 * Extend graph elements (i.e. vertices and edges) with domain-specific functionality.</p>

<p><img src="/pacer-doc/images/Extensions1.png" alt="Pacer Extensions"></p>

<p>Let&#39;s see an example ...</p>

<h3 id="setup">Setup</h3>

<p>Create a basic data set that will be used in this example.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;Pacer&#39;</span>

<span class="n">g</span> <span class="o">=</span> <span class="no">Pacer</span><span class="o">.</span><span class="n">tg</span><span class="p">()</span>

<span class="n">lax</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LAX&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;Los Angeles&#39;</span><span class="p">})</span>
<span class="n">lga</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">})</span>
<span class="n">sfo</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;SFO&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;San Francisco&#39;</span><span class="p">})</span>
<span class="n">yyz</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;YYZ&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;Toronto&#39;</span><span class="p">})</span>

<span class="n">lga</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">lax</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span>
<span class="n">lga</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">yyz</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Air Canada&#39;</span><span class="p">})</span>
<span class="n">yyz</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">lga</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Air Canada&#39;</span><span class="p">})</span>
<span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">yyz</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span>
<span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;WestJet&#39;</span><span class="p">})</span>
<span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;American Airlines&#39;</span><span class="p">})</span>
</code></pre></div>
<h3 id="our-first-(vertex)-extension">Our First (Vertex) Extension</h3>

<p>Since our vertices represent airports, we will extend them with an <code>Airport</code> module.<br>
Save the following code in a file called <code>example.rb</code> </p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Example</span>

    <span class="k">module</span> <span class="nn">Airport</span>

        <span class="k">module</span> <span class="nn">Vertex</span>

            <span class="k">def</span> <span class="nf">display_name</span>
                <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">[</span><span class="ss">:code</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="nb">self</span><span class="o">[</span><span class="ss">:city</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">end</span>
        <span class="k">end</span>


        <span class="k">module</span> <span class="nn">Route</span>

            <span class="k">def</span> <span class="nf">departures</span>
                <span class="n">out_e</span><span class="p">()</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">arrivals</span>
                <span class="n">in_e</span><span class="p">()</span>
            <span class="k">end</span>

        <span class="k">end</span>

    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Let&#39;s see how we can use the <code>Example::Airport</code> extension.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">207</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">load</span><span class="p">(</span><span class="s1">&#39;path/to/example.rb&#39;</span><span class="p">)</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">209</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">()</span>
<span class="c1">#&lt;V[3]&gt; #&lt;V[2]&gt; #&lt;V[1]&gt; #&lt;V[0]&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
<span class="c1">#&lt;GraphV&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">210</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">)</span>
<span class="c1">#&lt;V[3] YYZ, Toronto&gt;       #&lt;V[2] SFO, San Francisco&gt; #&lt;V[1] LGA, New York&gt;      #&lt;V[0] LAX, Los Angeles&gt;  </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
<span class="c1">#&lt;GraphV -&gt; V&gt;</span>
</code></pre></div>
<p>What just happened?</p>

<ul>
<li><code>g.v(Example::Airport)</code> returns (a route of) all vertices, wrapped in an <code>Example::Airport</code> extension.</li>
<li>The <code>Example::Airport::Vertex</code> module contains a method called <code>display_name</code>.<br>
This method is used by Pacer to print vertices to the console.</li>
</ul>

<p>In the example above, we extended the functionality of vertices by
 1. Defining methods inside the <code>Example::Airport::Vertex</code> module.
 2. Wrapping our vertices in the <code>Example::Airport</code> module/extension.</p>

<p>In the next example, we will extend the functionality of routes (i.e. collections) of vertices.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">213</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">,</span> <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">departures</span><span class="p">()</span>
<span class="c1">#&lt;E[5]:1-flies_to-3&gt; #&lt;E[4]:1-flies_to-0&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">2</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport, code==&quot;LGA&quot;) -&gt; outE&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">214</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">,</span> <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;SFO&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">arrivals</span><span class="p">()</span>
<span class="c1">#&lt;E[9]:0-flies_to-2&gt; #&lt;E[8]:0-flies_to-2&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">2</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport, code==&quot;SFO&quot;) -&gt; inE&gt;</span>
</code></pre></div>
<p>Let&#39;s look at the example above in more details:
 * <code>g.v(Example::Airport, {code: &#39;LGA&#39;})</code> gives us back a route of vertices.<br>
 * The vertices in the route are filtered, based on their <code>code</code> property, and wrapped in the <code>Example::Airport</code> extension.
 * Our <code>Example::Airport::Route</code> module defines the methods <code>arrivals</code> and <code>departures</code>.
 * This allows us to call the <code>arrivals</code> and <code>departures</code> methods on any route (of vertices that are) extended by <code>Example::Airport</code>.</p>

<p>So, this time, we extended the functionality of routes by
 1. Defining methods inside the <code>Example::Airport::Route</code> module.
 2. Wrapping our vertices in the <code>Example::Airport</code> module/extension.</p>

<h3 id="filtering-based-on-extension">Filtering based on extension</h3>

<p>What if our graph contains vertices that do not represent airports?<br>
When we ask for vertices wrapped in the <code>Example::Airport</code> extension, we want to get only vertices that actually represent airports.</p>

<p>We can achieve that by defining the <code>route_conditions</code> method in the <code>Example::Airport</code> module, as follows:
<code>ruby
def self.route_conditions(graph)
    {type: &#39;airport&#39;}
end
</code></p>

<p>This method tells Pacer that, only elements whose <code>type</code> property is <code>airport</code> can be wrapped in the <code>Example::Airport</code> extension. When we run <code>g.v(Example::Airport)</code>, vertices that do not have a <code>type</code> property whose value is <code>airport</code> will not be included in the result.</p>

<p>Let&#39;s see it in action.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">237</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">)</span>
<span class="c1">#&lt;V[3] YYZ, Toronto&gt;       #&lt;V[2] SFO, San Francisco&gt; #&lt;V[1] LGA, New York&gt;      #&lt;V[0] LAX, Los Angeles&gt;  </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
<span class="c1">#&lt;GraphV -&gt; V&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">238</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">foo</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>
<span class="c1">#&lt;V[10]&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">241</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">)</span>
<span class="c1">#&lt;V[3] YYZ, Toronto&gt;       #&lt;V[2] SFO, San Francisco&gt; #&lt;V[1] LGA, New York&gt;      #&lt;V[0] LAX, Los Angeles&gt;  </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport)&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">242</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">()</span>
<span class="c1">#&lt;V[3]&gt;  #&lt;V[2]&gt;  #&lt;V[10]&gt; #&lt;V[1]&gt;  #&lt;V[0]&gt; </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">5</span>
<span class="c1">#&lt;GraphV&gt;</span>
</code></pre></div>
<h3 id="extending-edges">Extending Edges</h3>

<p>Similarly to the way we extend vertices, we can also extend edges.<br>
Let&#39;s update <code>example.rb</code> to contain the following code:
```ruby
module Example</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">module Airport

    def self.route_conditions(graph)
        {type: &#39;airport&#39;}
    end


    module Vertex

        def display_name
            &quot;#{self[:code]}, #{self[:city]}&quot;
        end

    end


    module Route

        def departures
            out_e(Flight)
        end

        def arrivals
            in_e((Flight)
        end

    end


end


module Flight

    def self.route_conditions(graph)
        :flies_to
    end


    module Edge

        def display_name
            &quot;#{self[:airline]} flight from #{from[:code]} to #{to[:code]}&quot;
        end

        def from
            out_vertex(Airport)
        end

        def to
            in_vertex(Airport)
        end

    end

end
</code></pre></div>
<p>end
```</p>

<p>Let&#39;s see it in action.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">248</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">load</span><span class="p">(</span><span class="s1">&#39;path/to/example.rb&#39;</span><span class="p">)</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">249</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">e</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Flight</span><span class="p">)</span>
<span class="c1">#&lt;E[7]:Delta flight from LAX to YYZ&gt;             #&lt;E[6]:Air Canada flight from YYZ to LGA&gt;        #&lt;E[5]:Air Canada flight from LGA to YYZ&gt;       </span>
<span class="c1">#&lt;E[4]:Delta flight from LGA to LAX&gt;             #&lt;E[9]:American Airlines flight from LAX to SFO&gt; #&lt;E[8]:WestJet flight from LAX to SFO&gt;          </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">6</span>
<span class="c1">#&lt;GraphE -&gt; E&gt;</span>
</code></pre></div>
<h3 id="elements-vs.-routes">Elements vs. Routes</h3>

<p>The following example emphasizes the difference between an individual element (vertex or edge), and a route (a collections of elements).</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">254</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">e</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Flight</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">from</span>
<span class="ss">NoMethodError</span><span class="p">:</span> <span class="c1">#&lt;E[7]:Delta flight from LAX to YYZ&gt; #&lt;E[4]:Delta flight from LGA to LAX&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`from&#39; for #&lt;#&lt;Class:0x1257225&gt;:0x5565a1&gt;</span>

<span class="sb">irb(main):255:0&gt; g.e(Example::Flight, {airline: &#39;Delta&#39;}).first.from</span>
<span class="sb">#&lt;V[0] LAX, Los Angeles&gt;</span>
</code></pre></div>
<p>We have only defined the <code>from</code> method for individual edges, not for routes of edges.
Therefore, the first command above resulted in an error.</p>

<p>Let&#39;s change that and add the following code to the <code>Example::Flight</code> module:
```ruby
module Route</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">def from
    out_v(Airport)
end

def to
    in_v(Airport)
end
</code></pre></div>
<p>end
```</p>

<p>Reload the code in the IRB, and give it a try.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">031</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">e</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Flight</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">uniq</span>
<span class="c1">#&lt;V[0] LAX, Los Angeles&gt; #&lt;V[1] LGA, New York&gt;   </span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">2</span>
<span class="c1">#&lt;GraphE -&gt; E-Property(:flies_to, Example::Flight, airline==&quot;Delta&quot;) -&gt; outV -&gt; V-Property(Example::Airport) -&gt; uniq&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">032</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">e</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Flight</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">uniq</span>
<span class="c1">#&lt;V[3] YYZ, Toronto&gt;     #&lt;V[0] LAX, Los Angeles&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">2</span>
<span class="c1">#&lt;GraphE -&gt; E-Property(:flies_to, Example::Flight, airline==&quot;Delta&quot;) -&gt; inV -&gt; V-Property(Example::Airport) -&gt; uniq&gt;</span>
</code></pre></div>
<p>The queries above find all airports that Delta flies from/to.</p>

<h3 id="simplifying-complex-traversals">Simplifying Complex Traversals</h3>

<p>Extensions allow you to define a complex query as an extension method.
By doing so, you essentially extend the vocabulary of Pacer with a domain-specific vocabulary.</p>

<p>This concept allows you to focus on your domain problem, without thinking about the implementation details 
of complex graph algorithms. </p>

<p>Let&#39;s see an example. We will define the following method in <code>Example::Airport::Route</code> module:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">reachable_airports</span><span class="p">(</span><span class="n">max_hops</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">loop</span> <span class="p">{</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span> <span class="n">r</span><span class="o">.</span><span class="n">departures</span><span class="o">.</span><span class="n">to</span> <span class="p">}</span><span class="o">.</span><span class="n">while</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">path</span><span class="o">|</span> <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">max_hops</span><span class="p">;</span> <span class="ss">:emit_and_loop</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span><span class="o">.</span><span class="n">uniq</span>
<span class="k">end</span>
</code></pre></div>
<p>The method above returns airports that are reachable by taking at most <code>max_hops</code> flights.<br>
Although the implementation is slightly complex, once we have implemented the method, we never have to think about it again.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">277</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">,</span> <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reachable_airports</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#&lt;V[1] LGA, New York&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">1</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport, code==&quot;LGA&quot;) -&gt; V-Loop(#&lt;V -&gt; outE(:flies_to) -&gt; E -&gt; inV -&gt; V-Property(Example::Airport)&gt;) -&gt; uniq&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">278</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">,</span> <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reachable_airports</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#&lt;V[1] LGA, New York&gt;    #&lt;V[3] YYZ, Toronto&gt;     #&lt;V[0] LAX, Los Angeles&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">3</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport, code==&quot;LGA&quot;) -&gt; V-Loop(#&lt;V -&gt; outE(:flies_to) -&gt; E -&gt; inV -&gt; V-Property(Example::Airport)&gt;) -&gt; uniq&gt;</span>

<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">279</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="no">Example</span><span class="o">::</span><span class="no">Airport</span><span class="p">,</span> <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reachable_airports</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#&lt;V[1] LGA, New York&gt;      #&lt;V[3] YYZ, Toronto&gt;       #&lt;V[0] LAX, Los Angeles&gt;   #&lt;V[2] SFO, San Francisco&gt;</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
<span class="c1">#&lt;GraphV -&gt; V-Property(Example::Airport, code==&quot;LGA&quot;) -&gt; V-Loop(#&lt;V -&gt; outE(:flies_to) -&gt; E -&gt; inV -&gt; V-Property(Example::Airport)&gt;) -&gt; uniq&gt;</span>
</code></pre></div>
<p>We don&#39;t need to think of breadth/depth first search algorithms. 
Instead, we use a vocabulary that is specific to our domain, and ask for reachable airport.</p>

<h3 id="multiple-extensions">Multiple Extensions</h3>

<p>We can wrap a graph element with multiple extensions.<br>
To see an example, let&#39;s create the following extension in our <code>Example</code> module:
```ruby
module A</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Only elements whose `code` property is either `LGA` or `LAX` can be wrapped with this extension
def self.route_conditions(graph)
    {code: Set[&#39;LGA&#39;, &#39;LAX&#39;]}
end

module Route
def f()
    &quot;Dummy method f()&quot;
end
end
</code></pre></div>
<p>end
```</p>

<p>Now, let&#39;s use our extension, <code>A</code>, in the IRB:
```ruby
irb(main):100:0&gt; g.v(Example::A,Example::Airport)</p>

<h1 id="-#"><V[1] LGA, New York>    #<V[0] LAX, Los Angeles></h1>

<p>Total: 2</p>

<h1 id="-v-property(example::a,-example::airport)&gt;"><GraphV -> V-Property(Example::A, Example::Airport)&gt;</h1>

<p>irb(main):101:0&gt; g.v(Example::A,Example::Airport).f()
&quot;Dummy method f()&quot;
```</p>

<p>The example above shows us that:
 * Only vertices that can wrapped by <em>both</em> <code>Example::A</code> and <code>Example::Airport</code> are included in the result. 
 * The resulting route is extended with the functionality of both <code>Example::A</code> and <code>Example::Airport</code>.</p>

<h3 id="summary">Summary</h3>

<p>This is a good place to stop, summarize and add a few notes:
 * We can extend the functionality vertices, edges and routes with arbitrary modules, known as extensions.
 * We can also define custom filtering criteria for each extension we create.
 * We can extend Pacer&#39;s vocabulary with a domain-specific vocabulary, by defining complex queries in extension methods.
 * We can extend elements with multiple extensions.</p>

<h3 id="full-source-code">Full Source Code</h3>

<p>Here is the full source code for all of the above examples.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Example</span>


    <span class="c1"># A convenience function, used for creating and populating the graph for this example</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_graph</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="no">Pacer</span><span class="o">.</span><span class="n">tg</span><span class="p">()</span>

        <span class="n">lax</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LAX&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;Los Angeles&#39;</span><span class="p">})</span>
        <span class="n">lga</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;LGA&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">})</span>
        <span class="n">sfo</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;SFO&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;San Francisco&#39;</span><span class="p">})</span>
        <span class="n">yyz</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">({</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="ss">code</span><span class="p">:</span> <span class="s1">&#39;YYZ&#39;</span><span class="p">,</span> <span class="ss">city</span><span class="p">:</span> <span class="s1">&#39;Toronto&#39;</span><span class="p">})</span>

        <span class="n">lga</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">lax</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span>
        <span class="n">lga</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">yyz</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Air Canada&#39;</span><span class="p">})</span>
        <span class="n">yyz</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">lga</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Air Canada&#39;</span><span class="p">})</span>
        <span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">yyz</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;Delta&#39;</span><span class="p">})</span>
        <span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;WestJet&#39;</span><span class="p">})</span>
        <span class="n">lax</span><span class="o">.</span><span class="n">add_edges_to</span><span class="p">(</span><span class="ss">:flies_to</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="p">{</span><span class="ss">airline</span><span class="p">:</span> <span class="s1">&#39;American Airlines&#39;</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">g</span>
    <span class="k">end</span>



    <span class="k">module</span> <span class="nn">Airport</span>

        <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">route_conditions</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="p">{</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;airport&#39;</span><span class="p">}</span>
        <span class="k">end</span>


        <span class="k">module</span> <span class="nn">Vertex</span>

            <span class="k">def</span> <span class="nf">display_name</span>
                <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">[</span><span class="ss">:code</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="nb">self</span><span class="o">[</span><span class="ss">:city</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">end</span>

        <span class="k">end</span>


        <span class="k">module</span> <span class="nn">Route</span>

            <span class="k">def</span> <span class="nf">departures</span>
                <span class="n">out_e</span><span class="p">(</span><span class="no">Flight</span><span class="p">)</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">arrivals</span>
                <span class="n">in_e</span><span class="p">(</span><span class="no">Flight</span><span class="p">)</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">reachable_airports</span><span class="p">(</span><span class="n">max_hops</span><span class="p">)</span>
                <span class="nb">self</span><span class="o">.</span><span class="n">loop</span> <span class="p">{</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span> <span class="n">r</span><span class="o">.</span><span class="n">departures</span><span class="o">.</span><span class="n">to</span> <span class="p">}</span><span class="o">.</span><span class="n">while</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">path</span><span class="o">|</span> <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">max_hops</span><span class="p">;</span> <span class="ss">:emit_and_loop</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span><span class="o">.</span><span class="n">uniq</span>
            <span class="k">end</span>

        <span class="k">end</span>

    <span class="k">end</span>




    <span class="k">module</span> <span class="nn">Flight</span>

        <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">route_conditions</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="ss">:flies_to</span>
        <span class="k">end</span>


        <span class="k">module</span> <span class="nn">Edge</span>

            <span class="k">def</span> <span class="nf">display_name</span>
                <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">[</span><span class="ss">:airline</span><span class="o">]</span><span class="si">}</span><span class="s2"> flight from </span><span class="si">#{</span><span class="n">from</span><span class="o">[</span><span class="ss">:code</span><span class="o">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">#{</span><span class="n">to</span><span class="o">[</span><span class="ss">:code</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">from</span>
                <span class="n">out_vertex</span><span class="p">(</span><span class="no">Airport</span><span class="p">)</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">to</span>
                <span class="n">in_vertex</span><span class="p">(</span><span class="no">Airport</span><span class="p">)</span>
            <span class="k">end</span>

        <span class="k">end</span>

        <span class="k">module</span> <span class="nn">Route</span>

            <span class="k">def</span> <span class="nf">from</span>
                <span class="n">out_v</span><span class="p">(</span><span class="no">Airport</span><span class="p">)</span>
            <span class="k">end</span>

            <span class="k">def</span> <span class="nf">to</span>
                <span class="n">in_v</span><span class="p">(</span><span class="no">Airport</span><span class="p">)</span>
            <span class="k">end</span>

        <span class="k">end</span>

    <span class="k">end</span>




    <span class="k">module</span> <span class="nn">A</span>

        <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">route_conditions</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="p">{</span><span class="ss">code</span><span class="p">:</span> <span class="no">Set</span><span class="o">[</span><span class="s1">&#39;LGA&#39;</span><span class="p">,</span> <span class="s1">&#39;LAX&#39;</span><span class="o">]</span><span class="p">}</span>
        <span class="k">end</span>

        <span class="k">module</span> <span class="nn">Route</span>

            <span class="k">def</span> <span class="nf">f</span><span class="p">()</span>
                <span class="s2">&quot;Dummy method f()&quot;</span>
            <span class="k">end</span>

        <span class="k">end</span>
    <span class="k">end</span>


<span class="k">end</span>
</code></pre></div>

</div>








            </div>
        </div>
        <!-- /.row -->

        <hr>

        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    















































 



                </div>
            </div>
        </footer>

    </div>    <!-- /.container -->



 
</body>




</html>

